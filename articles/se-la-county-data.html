<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reproducing LA County Standard Errors from [@buja2019modelsasapproximationspart1] • maars</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Reproducing LA County Standard Errors from [@buja2019modelsasapproximationspart1]">
<meta property="og:description" content="maars">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">maars</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/se-la-county-data.html">Reproducing Buja et. al. Tables</a>
    </li>
    <li>
      <a href="../articles/hubbard-gee-simulation.html">Hubbard et. al simulation</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../news/index.html">Changelog</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/shamindras/maars/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="se-la-county-data_files/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="se-la-county-data_files/kePrint-0.0.1/kePrint.js"></script><link href="se-la-county-data_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Reproducing LA County Standard Errors from <span class="citation">(Buja et al. 2019)</span>
</h1>
                        <h4 data-toc-skip class="author">Riccardo Fogliato and Shamindra Shrotriya</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/shamindras/maars/blob/master/vignettes/se-la-county-data.Rmd" class="external-link"><code>vignettes/se-la-county-data.Rmd</code></a></small>
      <div class="hidden name"><code>se-la-county-data.Rmd</code></div>

    </div>

    
    
<div id="setup-and-installation" class="section level2">
<h2 class="hasAnchor">
<a href="#setup-and-installation" class="anchor" aria-hidden="true"></a>Setup and Installation</h2>
<p>First, we’ll need to install a set of packages that will be useful for the analysis. If you are a new user, you will need to manually run the following commands in a new in an <code>R</code> session before running the vignette code below:</p>
<br><details><p><summary>Required package installation and load</summary></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Install the required packages</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span>pkgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>
  <span class="st">"glue"</span>, <span class="st">"knitr"</span>, <span class="st">"tidyverse"</span>, <span class="st">"kableExtra"</span>,
  <span class="st">"remotes"</span>, <span class="st">"patchwork"</span>
<span class="op">)</span><span class="op">)</span>

<span class="co"># Install the latest version of the maars package</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"shamindras/maars"</span>, force <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># Load the required packages</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidyverse/glue" class="external-link">glue</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/shamindras/maars" class="external-link">maars</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">tidyverse</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org" class="external-link">remotes</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></code></pre></div>
</details><p><br></p>
<p>Note that we use the pipe (<code>%&gt;%</code>) operator loaded from the <code>tidyverse</code> package as part of the tidy <code>maars</code> inferential workflow. We will also set a global random seed for reproducibility purposes.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">25422267</span><span class="op">)</span></code></pre></div>
<p>We will refer to all other functions explicitly using the <code>package::function()</code> reference method to avoid any function reference source ambiguity.</p>
</div>
<div id="goal-of-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#goal-of-analysis" class="anchor" aria-hidden="true"></a>Goal of Analysis</h2>
<p>In this vignette, we will reproduce the results of Table 1 in <span class="citation">(Buja et al. 2019)</span>, as shown below:</p>
<div class="figure" style="text-align: center">
<img src="figures/buja1_table1.png" alt="Table 1 from [@buja2019modelsasapproximationspart1]" width="90%"><p class="caption">
Table 1 from <span class="citation">(Buja et al. 2019)</span>
</p>
</div>
</div>
<div id="loading-the-data" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-the-data" class="anchor" aria-hidden="true"></a>Loading the data</h2>
<p>Let’s first load the LA County Homeless persons data as used in <span class="citation">(Buja et al. 2019)</span> and briefly examine it. The dataset is included in the <code>maars</code> package for convenience.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># LA County source data - already built into maars</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"la_county"</span>, package <span class="op">=</span> <span class="st">"maars"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">la_county</span><span class="op">)</span>
<span class="co">#&gt; [1] 505   7</span></code></pre></div>
<p>So the dataset is relatively small with 505 observations and 7 features.</p>
<p>Let’s view the data interactively, with an emphasis on the first few rows. This is to get a better understanding of the structure of the <code>la_county</code> <code>tibble</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">la_county</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span>, format <span class="op">=</span> <span class="st">"html"</span>, digits <span class="op">=</span> <span class="fl">2</span>, align <span class="op">=</span> <span class="st">"c"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_classic.html" class="external-link">kable_classic</a></span><span class="op">(</span>kable_input <span class="op">=</span> <span class="va">.</span><span class="op">)</span></code></pre></div>
<table class="table table lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
<thead><tr>
<th style="text-align:center;">
StreetTotal
</th>
<th style="text-align:center;">
MedianInc1000
</th>
<th style="text-align:center;">
PercVacant
</th>
<th style="text-align:center;">
PercMinority
</th>
<th style="text-align:center;">
PercResidential
</th>
<th style="text-align:center;">
PercCommercial
</th>
<th style="text-align:center;">
PercIndustrial
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
41.58
</td>
<td style="text-align:center;">
2.58
</td>
<td style="text-align:center;">
30.47
</td>
<td style="text-align:center;">
86.68
</td>
<td style="text-align:center;">
12.23
</td>
<td style="text-align:center;">
0.00
</td>
</tr>
<tr>
<td style="text-align:center;">
0
</td>
<td style="text-align:center;">
53.48
</td>
<td style="text-align:center;">
2.84
</td>
<td style="text-align:center;">
16.92
</td>
<td style="text-align:center;">
12.09
</td>
<td style="text-align:center;">
0.26
</td>
<td style="text-align:center;">
0.00
</td>
</tr>
<tr>
<td style="text-align:center;">
6
</td>
<td style="text-align:center;">
35.24
</td>
<td style="text-align:center;">
2.03
</td>
<td style="text-align:center;">
64.39
</td>
<td style="text-align:center;">
15.83
</td>
<td style="text-align:center;">
5.66
</td>
<td style="text-align:center;">
4.31
</td>
</tr>
<tr>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
36.68
</td>
<td style="text-align:center;">
3.13
</td>
<td style="text-align:center;">
63.71
</td>
<td style="text-align:center;">
29.81
</td>
<td style="text-align:center;">
3.69
</td>
<td style="text-align:center;">
4.68
</td>
</tr>
<tr>
<td style="text-align:center;">
5
</td>
<td style="text-align:center;">
30.87
</td>
<td style="text-align:center;">
1.58
</td>
<td style="text-align:center;">
61.50
</td>
<td style="text-align:center;">
72.81
</td>
<td style="text-align:center;">
20.37
</td>
<td style="text-align:center;">
0.00
</td>
</tr>
<tr>
<td style="text-align:center;">
18
</td>
<td style="text-align:center;">
50.71
</td>
<td style="text-align:center;">
2.54
</td>
<td style="text-align:center;">
46.61
</td>
<td style="text-align:center;">
42.66
</td>
<td style="text-align:center;">
19.33
</td>
<td style="text-align:center;">
0.00
</td>
</tr>
</tbody>
</table>
<p>The <code>la_county</code> dataset is already in tidy format <span class="citation">(Wickham 2014)</span>.</p>
</div>
<div id="fitting-the-ols-model" class="section level2">
<h2 class="hasAnchor">
<a href="#fitting-the-ols-model" class="anchor" aria-hidden="true"></a>Fitting the OLS model</h2>
<p>We now fit a linear model of the count of homeless people (<code>StreetTotal</code>) as the response variable, against the other covariates using Ordinary Least Squares (OLS). As usual, this can be done via the <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">stats::lm()</a></code> function.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod_fit</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">StreetTotal</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">la_county</span><span class="op">)</span></code></pre></div>
<p>The most important thing to note at this stage is that the inference provided by the <code>mod_fit</code> (i.e. <code>lm</code>) object is based on the typical well-specified assumption setting. That is this fitted linear model assumes the linearity of the conditional expectation and the homoscedasticity of errors.</p>
<p>The goal of <code>maars</code> is to take the same OLS estimates for the fitted model parameters but augment the inference to be based in the model misspecified setting. This is done in the following sections, and drives the remainder of this reproducibility analysis.</p>
</div>
<div id="estimating-the-variance" class="section level2">
<h2 class="hasAnchor">
<a href="#estimating-the-variance" class="anchor" aria-hidden="true"></a>Estimating the variance</h2>
<p>As done in <span class="citation">(Buja et al. 2019)</span> let’s estimate the variance of the regression coefficients for the fitted model using model misspecified assumptions using the following approaches:</p>
<ul>
<li>
<strong>sandwich estimator</strong> (see <span class="citation">(White 1980a, @white1980usinglsapproxunknownregfuncs)</span> for more details).
<ul>
<li>(<span class="math inline">\(n\)</span>-out-of-<span class="math inline">\(n\)</span>) <strong>empirical bootstrap</strong> with <span class="math inline">\(B = 10^{3}\)</span> replications.</li>
<li>
<strong>multiplier bootstrap</strong> with <span class="math inline">\(B = 10^{3}\)</span> replications with the default Rademacher weights.</li>
<li>
<strong>residual bootstrap</strong> with <span class="math inline">\(B = 10^{3}\)</span> replications.</li>
</ul>
</li>
</ul>
<p>To do so, we will use the <code>comp_var</code> function in <code>maars</code>. This arguments in this function are the output of <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">stats::lm()</a></code> (i.e., <code>mod_fit</code>) and the types of estimators (of the variance) that we wish to use, with the specific parameters. The sandwich variance is always computed by default so there is no need to specify it.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mms_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/comp_var.html">comp_var</a></span><span class="op">(</span>
  mod_fit <span class="op">=</span> <span class="va">mod_fit</span>,
  boot_emp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>B <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="fl">3</span><span class="op">)</span>,
  boot_mul <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>B <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="fl">3</span>, weights_type <span class="op">=</span> <span class="st">"rademacher"</span><span class="op">)</span>,
  boot_res <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>B <span class="op">=</span> <span class="fl">10</span><span class="op">^</span><span class="fl">3</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>The resulting model misspecified linear model fit i.e. <code>mms_fit</code> is now a (maars_lm, lm) object. With this object constructed, we now have all of the ingredients necessary to reproduce Table 1 of the <span class="citation">(Buja et al. 2019)</span> paper.</p>
</div>
<div id="reproducing-table-1" class="section level2">
<h2 class="hasAnchor">
<a href="#reproducing-table-1" class="anchor" aria-hidden="true"></a>Reproducing Table 1</h2>
<p>In order to reproduce Table 1, we will only need the empirical bootstrap and sandwich estimates. In <code>maars</code>, the estimates, standard errors, <span class="math inline">\(t\)</span>-statistics, and <span class="math inline">\(p\)</span>-values can be obtained in a <code>tidy</code> output format via the function <code>get_summary</code>. This function returns the sandwich, again, returned by default, unless specified otherwise. Let’s first extract the summary of <code>mms_fit</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get output</span>
<span class="va">mms_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_summary.html">get_summary</a></span><span class="op">(</span><span class="va">mms_fit</span>, sand <span class="op">=</span> <span class="cn">TRUE</span>, 
                           boot_emp <span class="op">=</span> <span class="cn">TRUE</span>, 
                           well_specified <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co"># print heading</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">mms_summary</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span>, format <span class="op">=</span> <span class="st">"html"</span>, digits <span class="op">=</span> <span class="fl">3</span>, align <span class="op">=</span> <span class="st">"c"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_classic.html" class="external-link">kable_classic</a></span><span class="op">(</span>kable_input <span class="op">=</span> <span class="va">.</span><span class="op">)</span></code></pre></div>
<table class="table table lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
<thead><tr>
<th style="text-align:center;">
term
</th>
<th style="text-align:center;">
estimate
</th>
<th style="text-align:center;">
stat_type
</th>
<th style="text-align:center;">
stat_val
</th>
<th style="text-align:center;">
var_type_abb
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:center;">
(Intercept)
</td>
<td style="text-align:center;">
0.760
</td>
<td style="text-align:center;">
std.error
</td>
<td style="text-align:center;">
22.767
</td>
<td style="text-align:center;">
lm
</td>
</tr>
<tr>
<td style="text-align:center;">
(Intercept)
</td>
<td style="text-align:center;">
0.760
</td>
<td style="text-align:center;">
statistic
</td>
<td style="text-align:center;">
0.033
</td>
<td style="text-align:center;">
lm
</td>
</tr>
<tr>
<td style="text-align:center;">
(Intercept)
</td>
<td style="text-align:center;">
0.760
</td>
<td style="text-align:center;">
p.value
</td>
<td style="text-align:center;">
0.973
</td>
<td style="text-align:center;">
lm
</td>
</tr>
<tr>
<td style="text-align:center;">
MedianInc1000
</td>
<td style="text-align:center;">
-0.183
</td>
<td style="text-align:center;">
std.error
</td>
<td style="text-align:center;">
0.187
</td>
<td style="text-align:center;">
lm
</td>
</tr>
<tr>
<td style="text-align:center;">
MedianInc1000
</td>
<td style="text-align:center;">
-0.183
</td>
<td style="text-align:center;">
statistic
</td>
<td style="text-align:center;">
-0.977
</td>
<td style="text-align:center;">
lm
</td>
</tr>
<tr>
<td style="text-align:center;">
MedianInc1000
</td>
<td style="text-align:center;">
-0.183
</td>
<td style="text-align:center;">
p.value
</td>
<td style="text-align:center;">
0.329
</td>
<td style="text-align:center;">
lm
</td>
</tr>
</tbody>
</table>
<p>As we can see, the output is in tidy <code>tibble</code> format. This makes it much more readily amenable for additional transformations using the <code>tidyverse</code> set of packages.</p>
<p>We can now reformat the output of <code>get_summary</code> to make it more easily comparable to Table 1 in the paper. This can be achieved by first dropping the p-values (which are not needed), followed by the computation of the ratios of the variances, and last by an application of the <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">tidyr::pivot_wider()</a></code> function. We also need add in the required <span class="math inline">\(\LaTeX\)</span> code for the column names to reproduce values and formatting as in the original table.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mms_summary</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="co"># drop the p-values</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">stat_type</span> <span class="op">!=</span> <span class="st">"p.value"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="co"># compute the variances</span>
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>
    names_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stat_type</span>, <span class="va">var_type_abb</span><span class="op">)</span>,
    values_from <span class="op">=</span> <span class="va">stat_val</span>
  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="co"># compute the ratios</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>
    ratio_emp_vs_lm <span class="op">=</span> <span class="va">std.error_emp</span> <span class="op">/</span> <span class="va">std.error_lm</span>,
    ratio_sand_vs_lm <span class="op">=</span> <span class="va">std.error_sand</span> <span class="op">/</span> <span class="va">std.error_emp</span>,
    ratio_sand_vs_emp <span class="op">=</span> <span class="va">std.error_sand</span> <span class="op">/</span> <span class="va">std.error_emp</span>
  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="co"># reorder the variables</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span>
    <span class="va">term</span>,
    <span class="va">estimate</span>,
    <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"std.error"</span><span class="op">)</span>,
    <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"ratio"</span><span class="op">)</span>,
    <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"statistic"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="co"># rename the variables</span>
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/set_names.html" class="external-link">set_names</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span>, nm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>
    <span class="st">"Term"</span>, <span class="st">"$\\widehat{\\beta}_{j}$"</span>,
    <span class="st">"$SE_{\\text{lin}}$"</span>,
    <span class="st">"$SE_{\\text{boot}}$"</span>,
    <span class="st">"$SE_{\\text{sand}}$"</span>,
    <span class="st">"$\\frac{SE_{\\text{boot}}}{SE_{\\text{lin}}}$"</span>,
    <span class="st">"$\\frac{SE_{\\text{sand}}}{SE_{\\text{lin}}}$"</span>,
    <span class="st">"$\\frac{SE_{\\text{sand}}}{SE_{\\text{boot}}}$"</span>,
    <span class="st">"$t_{\\text{lin}}$"</span>,
    <span class="st">"$t_{\\text{boot}}$"</span>,
    <span class="st">"$t_{\\text{sand}}$"</span>
  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>
    x <span class="op">=</span> <span class="va">.</span>, format <span class="op">=</span> <span class="st">"html"</span>, digits <span class="op">=</span> <span class="fl">3</span>,
    align <span class="op">=</span> <span class="st">"c"</span>, escape <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>position <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_classic.html" class="external-link">kable_classic</a></span><span class="op">(</span>kable_input <span class="op">=</span> <span class="va">.</span><span class="op">)</span></code></pre></div>
<table class="table table lightable-classic" style='margin-left: auto; margin-right: auto; font-family: "Arial Narrow", "Source Sans Pro", sans-serif; margin-left: auto; margin-right: auto;'>
<thead><tr>
<th style="text-align:center;">
Term
</th>
<th style="text-align:center;">
<span class="math inline">\(\widehat{\beta}_{j}\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(SE_{\text{lin}}\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(SE_{\text{boot}}\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(SE_{\text{sand}}\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(\frac{SE_{\text{boot}}}{SE_{\text{lin}}}\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(\frac{SE_{\text{sand}}}{SE_{\text{lin}}}\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(\frac{SE_{\text{sand}}}{SE_{\text{boot}}}\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(t_{\text{lin}}\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(t_{\text{boot}}\)</span>
</th>
<th style="text-align:center;">
<span class="math inline">\(t_{\text{sand}}\)</span>
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:center;">
(Intercept)
</td>
<td style="text-align:center;">
0.760
</td>
<td style="text-align:center;">
22.767
</td>
<td style="text-align:center;">
15.909
</td>
<td style="text-align:center;">
16.627
</td>
<td style="text-align:center;">
0.730
</td>
<td style="text-align:center;">
0.957
</td>
<td style="text-align:center;">
0.957
</td>
<td style="text-align:center;">
0.033
</td>
<td style="text-align:center;">
0.048
</td>
<td style="text-align:center;">
0.046
</td>
</tr>
<tr>
<td style="text-align:center;">
MedianInc1000
</td>
<td style="text-align:center;">
-0.183
</td>
<td style="text-align:center;">
0.187
</td>
<td style="text-align:center;">
0.105
</td>
<td style="text-align:center;">
0.114
</td>
<td style="text-align:center;">
0.606
</td>
<td style="text-align:center;">
0.923
</td>
<td style="text-align:center;">
0.923
</td>
<td style="text-align:center;">
-0.977
</td>
<td style="text-align:center;">
-1.745
</td>
<td style="text-align:center;">
-1.610
</td>
</tr>
<tr>
<td style="text-align:center;">
PercVacant
</td>
<td style="text-align:center;">
4.629
</td>
<td style="text-align:center;">
0.901
</td>
<td style="text-align:center;">
1.287
</td>
<td style="text-align:center;">
1.406
</td>
<td style="text-align:center;">
1.561
</td>
<td style="text-align:center;">
0.915
</td>
<td style="text-align:center;">
0.915
</td>
<td style="text-align:center;">
5.140
</td>
<td style="text-align:center;">
3.597
</td>
<td style="text-align:center;">
3.292
</td>
</tr>
<tr>
<td style="text-align:center;">
PercMinority
</td>
<td style="text-align:center;">
0.123
</td>
<td style="text-align:center;">
0.176
</td>
<td style="text-align:center;">
0.162
</td>
<td style="text-align:center;">
0.163
</td>
<td style="text-align:center;">
0.924
</td>
<td style="text-align:center;">
0.997
</td>
<td style="text-align:center;">
0.997
</td>
<td style="text-align:center;">
0.701
</td>
<td style="text-align:center;">
0.761
</td>
<td style="text-align:center;">
0.759
</td>
</tr>
<tr>
<td style="text-align:center;">
PercResidential
</td>
<td style="text-align:center;">
-0.050
</td>
<td style="text-align:center;">
0.171
</td>
<td style="text-align:center;">
0.108
</td>
<td style="text-align:center;">
0.112
</td>
<td style="text-align:center;">
0.651
</td>
<td style="text-align:center;">
0.972
</td>
<td style="text-align:center;">
0.972
</td>
<td style="text-align:center;">
-0.292
</td>
<td style="text-align:center;">
-0.462
</td>
<td style="text-align:center;">
-0.449
</td>
</tr>
<tr>
<td style="text-align:center;">
PercCommercial
</td>
<td style="text-align:center;">
0.737
</td>
<td style="text-align:center;">
0.273
</td>
<td style="text-align:center;">
0.388
</td>
<td style="text-align:center;">
0.396
</td>
<td style="text-align:center;">
1.450
</td>
<td style="text-align:center;">
0.980
</td>
<td style="text-align:center;">
0.980
</td>
<td style="text-align:center;">
2.700
</td>
<td style="text-align:center;">
1.901
</td>
<td style="text-align:center;">
1.862
</td>
</tr>
<tr>
<td style="text-align:center;">
PercIndustrial
</td>
<td style="text-align:center;">
0.905
</td>
<td style="text-align:center;">
0.321
</td>
<td style="text-align:center;">
0.579
</td>
<td style="text-align:center;">
0.586
</td>
<td style="text-align:center;">
1.823
</td>
<td style="text-align:center;">
0.988
</td>
<td style="text-align:center;">
0.988
</td>
<td style="text-align:center;">
2.818
</td>
<td style="text-align:center;">
1.565
</td>
<td style="text-align:center;">
1.546
</td>
</tr>
</tbody>
</table>
<p>Voila! We have reproduced Table 1 in <span class="citation">(Buja et al. 2019)</span>. Note that there are minor differences due to slightly different parameters and random seeds used in our analysis to the original paper.</p>
<p>We could also obtain the other types of estimates of the variance (i.e., from residual and multiplier bootstraps) that we computed in <code><a href="../reference/comp_var.html">comp_var()</a></code> in tidy format by specifying these additional arguments within <code><a href="../reference/get_summary.html">get_summary()</a></code>.</p>
</div>
<div id="visualizing-the-estimates" class="section level2">
<h2 class="hasAnchor">
<a href="#visualizing-the-estimates" class="anchor" aria-hidden="true"></a>Visualizing the estimates</h2>
<p>We may want to compare some of the estimates that we obtained through <code><a href="../reference/comp_var.html">comp_var()</a></code> in a plot. Confidence intervals and normality of the (bootstrap) estimates represent two (arguably) interesting statistics the data scientist/researcher may want to look at. The corresponding plots are returned by default when <code>plot</code> is called on an object of class <code>maars_lm</code>, together with six other “typical” <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">stats::lm()</a></code> plots. The plots can be visualized sequentially calling <code>plot</code> on an object of class maars_lm, lm (e.g., <code>plot(mms_fit, which=c(1,2,7)</code>). Alternatively, we can store them in a list via <code><a href="../reference/get_plot.html">get_plot()</a></code>, as we do below.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mms_plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_plot.html">get_plot</a></span><span class="op">(</span><span class="va">mms_fit</span><span class="op">)</span></code></pre></div>
<p>Let’s first look at the six “typical” <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">stats::lm()</a></code> plots. We will do some minor formatting of the plot text size. Since the output is a <code>list</code> we can simply do this in a single pipeline using the relevant <code>purrr</code> and <code>patchwork</code> functions.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fl">1</span><span class="op">:</span><span class="fl">6</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="op">~</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html" class="external-link">pluck</a></span><span class="op">(</span><span class="va">mms_plots</span>, <span class="va">.</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>plot.title <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">9</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span><span class="va">.</span>, ncol <span class="op">=</span> <span class="fl">3</span>, nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p><img src="se-la-county-data_files/figure-html/compare_lm-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Let’s compare confidence intervals for the regression coefficients based on the different types of estimators of the variance. Since all <code>maars</code> plot outputs are by default <code>ggplot</code> objects, we can adjust the plot legend and other formats easily, as demonstrated below.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html" class="external-link">pluck</a></span><span class="op">(</span><span class="va">mms_plots</span>, <span class="st">"p7"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="se-la-county-data_files/figure-html/compare_confint-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Let’s now visualize the distribution of the bootstrap estimate to check whether it well approximates the normal distribution.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html" class="external-link">pluck</a></span><span class="op">(</span><span class="va">mms_plots</span>, <span class="st">"p8"</span><span class="op">)</span></code></pre></div>
<p><img src="se-la-county-data_files/figure-html/visualize_boot_estimates-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor" aria-hidden="true"></a>References</h2>
<div id="refs" class="references">
<div id="ref-buja2019modelsasapproximationspart1">
<p>Buja, Andreas, Lawrence Brown, Richard Berk, Edward George, Emil Pitkin, Mikhail Traskin, Kai Zhang, and Linda Zhao. 2019. “Models as Approximations I: Consequences Illustrated with Linear Regression.” <em>Statist. Sci.</em> 34 (4): 523–44.</p>
</div>
<div id="ref-white1980heteroskedasticconsistentcovest">
<p>White, Halbert. 1980a. “A Heteroskedasticity-Consistent Covariance Matrix Estimator and a Direct Test for Heteroskedasticity.” <em>Econometrica</em> 48 (4): 817–38.</p>
</div>
<div id="ref-white1980usinglsapproxunknownregfuncs">
<p>———. 1980b. “Using Least Squares to Approximate Unknown Regression Functions.” <em>Internat. Econom. Rev.</em> 21 (1): 149–70.</p>
</div>
<div id="ref-wickham2014tidydata">
<p>Wickham, Hadley. 2014. “Tidy Data.” <em>Journal of Statistical Software</em> 59 (10).</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Shamindra Shrotriya, Riccardo Fogliato, Arun Kumar Kuchibhotla.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.6.1.9001.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'f0ad25edfd6fa5501f3057affbad5212',
    indexName: 'maars',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
